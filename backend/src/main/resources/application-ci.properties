# Ultra-fast CI-specific configuration
# This profile is designed for maximum startup speed in CI environments

# H2 Database Configuration with MySQL Compatibility Mode (copied from e2e profile)
spring.datasource.url=jdbc:h2:mem:ci_testdb;MODE=MySQL;DATABASE_TO_LOWER=TRUE;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# H2 Web Console for debugging
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=true

# Flyway disabled - use JPA DDL generation instead
spring.flyway.enabled=false
spring.jpa.defer-datasource-initialization=true

# JWT Configuration for CI
guardianes.jwt.secret=ci_test_secret_key_for_testing_purposes_only_minimum_256_bits_long
guardianes.jwt.expiration=86400000

# Security configuration for CI testing
spring.security.user.roles=USER

# Optimized initialization for CI
spring.main.lazy-initialization=false
spring.main.banner-mode=off
spring.main.register-shutdown-hook=false
spring.main.web-application-type=servlet

# JPA optimizations for CI
spring.jpa.hibernate.ddl-auto=create
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Disable all unnecessary components
spring.jpa.properties.hibernate.validator.apply_to_ddl=false
spring.jpa.properties.hibernate.validator.autoregister_listeners=false
spring.jpa.properties.hibernate.check_nullability=false

# Minimal connection pool for CI
spring.datasource.hikari.maximum-pool-size=2
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=60000
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.validation-timeout=2000
spring.datasource.hikari.initialization-fail-timeout=5000

# Minimal Tomcat for health checks only
server.tomcat.threads.min-spare=1
server.tomcat.threads.max=3
server.tomcat.max-connections=5
server.tomcat.accept-count=3
server.tomcat.connection-timeout=5000
server.tomcat.keep-alive-timeout=5000

# Disable all unnecessary auto-configurations (keeping Jackson for JSON processing)
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\
  org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
  org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\
  org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
  org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\
  org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration

# Disable metrics and monitoring for startup speed
management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true
management.endpoint.info.enabled=true
management.endpoint.metrics.enabled=false
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=false
management.metrics.binders.system.enabled=false
management.metrics.binders.tomcat.enabled=false
management.metrics.binders.processor.enabled=false
management.metrics.binders.uptime.enabled=false
management.metrics.binders.jvm.enabled=false

# Optimized logging for CI debugging
logging.level.com.guardianes=INFO
logging.level.org.springframework.boot=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN
logging.level.org.apache.tomcat=WARN
logging.level.org.apache.catalina=WARN
logging.level.root=WARN

# Security optimizations
spring.security.user.name=ci
spring.security.user.password=ci_test
spring.security.user.roles=USER

# Disable data initialization for faster startup (we'll add data after startup)
spring.sql.init.mode=never

# Disable Spring Boot features not needed for CI
spring.main.allow-bean-definition-overriding=true
spring.aop.auto=false
spring.jpa.open-in-view=false